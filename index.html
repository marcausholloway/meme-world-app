<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme & Template Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1e293b; /* Premium dark background color */
            color: #e2e8f0; /* Light text for contrast */
        }
        /* Style for the new top navigation bar */
        header {
            background-color: #0f172a;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .masonry-grid {
            column-count: 1;
            column-gap: 1.5rem; /* Increased gap */
        }
        @media (min-width: 640px) {
            .masonry-grid {
                column-count: 2;
            }
        }
        @media (min-width: 768px) {
            .masonry-grid {
                column-count: 3;
            }
        }
        @media (min-width: 1024px) {
            .masonry-grid {
                column-count: 4;
            }
        }
        .masonry-item {
            display: inline-block;
            width: 100%;
            margin-bottom: 1.5rem; /* Increased margin */
            border-radius: 0.75rem;
            overflow: hidden;
            background-color: #334155; /* Dark card background */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            transform: scale(1);
        }
        /* Hover effect for masonry cards */
        .masonry-item:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .no-data-message {
            text-align: center;
            font-size: 1.25rem;
            color: #94a3b8; /* Lighter text color */
            padding: 2rem;
        }
        /* Hover effect for buttons */
        .hover-effect {
            transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
        }
        .hover-effect:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <div id="app" class="flex-1 flex flex-col">
        <!-- TOP NAVIGATION BAR -->
        <header class="p-4 flex flex-col md:flex-row md:justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <button id="home-button" class="flex items-center gap-2 p-3 text-sm font-medium text-white bg-indigo-600 rounded-full hover:bg-indigo-700 hover-effect">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    Home
                </button>
            </div>
            <div class="flex flex-col items-center">
                <span class="text-xs text-gray-400">Your User ID:</span>
                <span id="user-id" class="text-sm font-semibold text-gray-400 truncate max-w-full">Guest User</span>
            </div>
            <div class="flex items-center gap-2">
                <button id="upload-meme-button" class="flex items-center gap-2 p-3 text-sm font-medium text-white bg-green-500 rounded-full hover:bg-green-600 hover-effect">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                    Upload Meme
                </button>
                <button id="upload-template-button" class="flex items-center gap-2 p-3 text-sm font-medium text-white bg-blue-500 rounded-full hover:bg-blue-600 hover-effect">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                    Upload Template
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto p-4 md:p-8">
            <div id="content-area"></div>
        </main>

        <!-- Modal for Upload -->
        <div id="upload-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 hidden flex justify-center items-center">
            <div class="bg-gray-800 text-gray-200 rounded-xl p-8 w-11/12 md:w-1/2 lg:w-1/3 shadow-2xl">
                <h2 id="modal-title" class="text-2xl font-bold mb-4">Upload Meme</h2>
                <form id="upload-form" class="space-y-4">
                    <div>
                        <label for="image-file" class="block text-sm font-medium">Select Image</label>
                        <input type="file" id="image-file" name="image-file" accept="image/*" class="mt-1 block w-full rounded-md border-gray-700 bg-gray-700 shadow-sm p-2" required>
                    </div>
                    <div>
                        <label for="category" class="block text-sm font-medium">Category</label>
                        <select id="category" name="category" class="mt-1 block w-full rounded-md border-gray-700 bg-gray-700 shadow-sm p-2" required>
                            <option value="">Select a category</option>
                            <option value="sad">Sad</option>
                            <option value="happy">Happy</option>
                            <option value="educational">Educational</option>
                            <option value="surprised">Surprised</option>
                            <option value="politics">Politics</option>
                        </select>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button type="button" id="cancel-upload" class="px-4 py-2 text-sm font-medium text-gray-200 bg-gray-600 rounded-full hover:bg-gray-700 hover-effect">Cancel</button>
                        <button type="submit" id="submit-upload" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-full hover:bg-indigo-700 hover-effect">Upload</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal for Image View and Reactions -->
        <div id="image-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 hidden flex justify-center items-center">
            <div class="bg-gray-800 text-gray-200 rounded-xl p-6 w-11/12 md:w-2/3 lg:w-1/2 relative shadow-2xl">
                <button id="close-image-modal" class="absolute top-2 right-2 text-gray-400 hover:text-gray-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <img id="modal-image" src="" alt="Full size content" class="w-full h-auto rounded-lg shadow-md" />
                    </div>
                    <div class="flex-1 flex flex-col justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-400 mb-2">Category: <span id="modal-category" class="text-indigo-400 font-semibold"></span></p>
                            <p class="text-sm font-medium text-gray-400 mb-4">Type: <span id="modal-type" class="text-indigo-400 font-semibold"></span></p>
                        </div>
                        <div class="flex flex-col gap-4">
                            <div class="flex items-center gap-2 text-sm font-medium text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                <span id="reaction-count">0 Reactions</span>
                            </div>
                            <div class="flex items-center gap-2 text-sm font-medium text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                <span id="download-count">0 Downloads</span>
                            </div>
                        </div>
                        <div class="flex gap-2 mt-4">
                            <button id="react-button" class="flex-1 px-4 py-2 text-sm font-medium text-white bg-red-500 rounded-full hover:bg-red-600 hover-effect">
                                <span id="react-button-text">React</span>
                            </button>
                            <a id="download-button" download class="flex-1 text-center px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-full hover:bg-indigo-700 hover-effect cursor-pointer">Download</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const contentArea = document.getElementById('content-area');
        const uploadModal = document.getElementById('upload-modal');
        const imageModal = document.getElementById('image-modal');
        const userIdDisplay = document.getElementById('user-id');

        let currentPage = 'home';
        let currentType = null;
        let currentCategory = null;
        let userId = 'local-user-' + Math.random().toString(36).substr(2, 9);
        userIdDisplay.textContent = userId;

        // --- Data Storage (using localStorage) ---
        const getLocalStorageData = () => {
            const memes = JSON.parse(localStorage.getItem('memes')) || [];
            const templates = JSON.parse(localStorage.getItem('templates')) || [];
            return { memes, templates };
        };

        const saveToLocalStorage = (type, data) => {
            if (type === 'meme') {
                localStorage.setItem('memes', JSON.stringify(data));
            } else {
                localStorage.setItem('templates', JSON.stringify(data));
            }
        };

        const getContentData = (type) => {
            const { memes, templates } = getLocalStorageData();
            return type === 'meme' ? memes : templates;
        };

        const updateContentItem = (type, id, updates) => {
            const data = getContentData(type);
            const itemIndex = data.findIndex(item => item.id === id);
            if (itemIndex !== -1) {
                const updatedItem = { ...data[itemIndex], ...updates };
                data[itemIndex] = updatedItem;
                saveToLocalStorage(type, data);
            }
        };

        // --- UI Rendering Functions ---
        const renderContent = () => {
            contentArea.innerHTML = '';
            
            switch (currentPage) {
                case 'home':
                    renderHomePage();
                    break;
                case 'categories':
                    renderCategoriesPage(currentType);
                    break;
                case 'browse-content':
                    renderContentGrid(currentType, currentCategory);
                    break;
            }
        };

        const renderHomePage = () => {
            contentArea.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <div id="browse-memes" class="flex flex-col items-center justify-center p-8 bg-slate-700 text-gray-200 rounded-2xl shadow-lg cursor-pointer hover:shadow-xl hover-effect">
                        <div class="bg-indigo-100 rounded-full p-4 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                        </div>
                        <h2 class="text-3xl font-bold">Browse Memes</h2>
                    </div>
                    <div id="browse-templates" class="flex flex-col items-center justify-center p-8 bg-slate-700 text-gray-200 rounded-2xl shadow-lg cursor-pointer hover:shadow-xl hover-effect">
                        <div class="bg-purple-100 rounded-full p-4 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-purple-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                        </div>
                        <h2 class="text-3xl font-bold">Browse Templates</h2>
                    </div>
                </div>
            `;
            document.getElementById('browse-memes').addEventListener('click', () => {
                currentPage = 'categories';
                currentType = 'meme';
                renderContent();
            });
            document.getElementById('browse-templates').addEventListener('click', () => {
                currentPage = 'categories';
                currentType = 'template';
                renderContent();
            });
        };

        const renderCategoriesPage = (type) => {
            const categories = ['Sad', 'Happy', 'Educational', 'Surprised', 'Politics'];
            const title = type.charAt(0).toUpperCase() + type.slice(1);
            contentArea.innerHTML = `
                <h1 class="text-3xl md:text-4xl font-extrabold text-gray-200 mb-8 text-center">Browse ${title} Categories</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-4xl mx-auto">
                    ${categories.map(cat => `
                        <button class="category-button w-full p-6 bg-slate-700 text-gray-200 rounded-xl shadow-lg flex justify-between items-center hover-effect" data-category="${cat.toLowerCase()}">
                            <span class="text-xl font-semibold">${cat}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    `).join('')}
                </div>
            `;
            document.querySelectorAll('.category-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const category = e.currentTarget.dataset.category;
                    currentPage = 'browse-content';
                    currentCategory = category;
                    renderContent();
                });
            });
        };

        const renderContentGrid = (type, category) => {
            contentArea.innerHTML = `
                <h1 class="text-3xl md:text-4xl font-extrabold text-gray-200 mb-8 text-center">
                    ${category.charAt(0).toUpperCase() + category.slice(1)} ${type.charAt(0).toUpperCase() + type.slice(1)}s
                </h1>
                <div id="grid-container" class="masonry-grid">
                    <!-- Content will be injected here -->
                </div>
            `;
            fetchContent(type, category);
        };

        const showUploadModal = (type) => {
            document.getElementById('modal-title').textContent = `Upload ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            document.getElementById('upload-form').dataset.type = type;
            uploadModal.classList.remove('hidden');
        };

        const closeUploadModal = () => {
            document.getElementById('upload-form').reset();
            uploadModal.classList.add('hidden');
        };

        const showImageModal = (content) => {
            document.getElementById('modal-image').src = content.imageDataUrl;
            document.getElementById('modal-image').onerror = () => document.getElementById('modal-image').src = 'https://placehold.co/600x400/8b5cf6/ffffff?text=Image+Not+Found';
            document.getElementById('modal-category').textContent = content.category.charAt(0).toUpperCase() + content.category.slice(1);
            document.getElementById('modal-type').textContent = content.type.charAt(0).toUpperCase() + content.type.slice(1);
            
            const reactionCount = Object.keys(content.reactions || {}).length;
            document.getElementById('reaction-count').textContent = `${reactionCount} Reactions`;
            document.getElementById('download-count').textContent = `${content.downloads || 0} Downloads`;
            
            document.getElementById('download-button').href = content.imageDataUrl;
            document.getElementById('download-button').download = 'downloaded_image.png';

            const reactButton = document.getElementById('react-button');
            const hasReacted = content.reactions && content.reactions[userId];
            reactButton.dataset.id = content.id;
            reactButton.dataset.reacted = hasReacted ? 'true' : 'false';
            reactButton.querySelector('span').textContent = hasReacted ? 'Unreact' : 'React';
            reactButton.classList.toggle('bg-red-500', !hasReacted);
            reactButton.classList.toggle('bg-gray-500', hasReacted);
            reactButton.classList.toggle('hover:bg-red-600', !hasReacted);
            reactButton.classList.toggle('hover:bg-gray-600', hasReacted);
            reactButton.onclick = () => handleReact(content.id, !hasReacted);

            imageModal.classList.remove('hidden');
        };

        const closeImageModal = () => {
            imageModal.classList.add('hidden');
        };

        // --- Local Storage Interaction Functions ---
        const fetchContent = (type, category) => {
            const grid = document.getElementById('grid-container');
            const allContent = getContentData(type);
            const filteredContent = allContent.filter(item => item.category === category);

            if (filteredContent.length === 0) {
                grid.innerHTML = '<div class="no-data-message">No content found in this category. Be the first to upload one!</div>';
                return;
            }

            grid.innerHTML = filteredContent.map(item => `
                <div class="masonry-item cursor-pointer" data-id="${item.id}" data-type="${item.type}">
                    <img src="${item.imageDataUrl}" alt="Content" class="w-full h-auto rounded-t-xl" onerror="this.onerror=null;this.src='https://placehold.co/600x400/8b5cf6/ffffff?text=Image+Not+Found';" />
                    <div class="p-4 flex justify-between items-center text-sm font-medium text-gray-400">
                        <span class="flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-400" viewBox="0 0 24 24" fill="currentColor"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                            <span>${Object.keys(item.reactions || {}).length}</span>
                        </span>
                        <span class="flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-400" viewBox="0 0 24 24" fill="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline></svg>
                            <span>${item.downloads || 0}</span>
                        </span>
                    </div>
                </div>
            `).join('');

            document.querySelectorAll('.masonry-item').forEach(item => {
                item.addEventListener('click', () => {
                    const id = item.dataset.id;
                    const type = item.dataset.type;
                    const contentItem = getContentData(type).find(c => c.id === id);
                    if (contentItem) {
                        showImageModal(contentItem);
                    }
                });
            });
        };

        const handleUpload = (event) => {
            event.preventDefault();
            const type = event.target.dataset.type;
            const fileInput = document.getElementById('image-file');
            const category = document.getElementById('category').value;
            const file = fileInput.files[0];

            if (!file) {
                console.error("No file selected.");
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const imageDataUrl = e.target.result;
                const newItem = {
                    id: crypto.randomUUID(),
                    type,
                    imageDataUrl,
                    category,
                    reactions: {},
                    downloads: 0
                };
                const data = getContentData(type);
                data.push(newItem);
                saveToLocalStorage(type, data);
                
                // Navigate to the correct page after successful upload
                closeUploadModal();
                currentType = type;
                currentCategory = category;
                currentPage = 'browse-content';
                renderContent();
            };
            reader.readAsDataURL(file);
        };

        const handleReact = (id, shouldReact) => {
            const type = document.getElementById('modal-type').textContent.toLowerCase();
            const data = getContentData(type);
            const item = data.find(item => item.id === id);
            if (item) {
                if (shouldReact) {
                    item.reactions[userId] = true;
                } else {
                    delete item.reactions[userId];
                }
                updateContentItem(type, id, { reactions: item.reactions });
                showImageModal(item);
                renderContent();
            }
        };

        const handleDownload = (id) => {
            const type = document.getElementById('modal-type').textContent.toLowerCase();
            const data = getContentData(type);
            const item = data.find(item => item.id === id);
            if (item) {
                const updatedDownloads = (item.downloads || 0) + 1;
                updateContentItem(type, id, { downloads: updatedDownloads });
                showImageModal({ ...item, downloads: updatedDownloads });
                renderContent();
            }
        };

        // --- Event Listeners ---
        document.getElementById('home-button').addEventListener('click', () => {
            currentPage = 'home';
            currentType = null;
            currentCategory = null;
            renderContent();
        });

        document.getElementById('upload-meme-button').addEventListener('click', () => showUploadModal('meme'));
        document.getElementById('upload-template-button').addEventListener('click', () => showUploadModal('template'));
        document.getElementById('cancel-upload').addEventListener('click', closeUploadModal);
        document.getElementById('upload-form').addEventListener('submit', handleUpload);
        document.getElementById('close-image-modal').addEventListener('click', closeImageModal);
        window.addEventListener('click', (event) => {
            if (event.target === uploadModal) {
                closeUploadModal();
            }
            if (event.target === imageModal) {
                closeImageModal();
            }
        });

        // Initial render
        renderContent();
    </script>
</body>
</html>
